import adsk.core, adsk.fusion, adsk.cam, traceback
import csv
import math
centres = [(0, 0, 0), #plane 1
            (5.333, 0, -144.623), #plane 2
            (36.791, 0, -289.331), #plane 3
            (91.665, 0, -426.512), #plane 4
            (167.629, 0, -554.016), #plane 5
            (279.67, 0, -656.591), #plane 6
            (407.779, 0, -737.83), #plane 7
            (536.748, 0, -799.26), #plane 8
            (672.528, 0, -835.133), #plane 9
            (814.82, 0, -847.56), #plane 10
            (977.817, 0, -845.565), #plane 11
            (1138.74, 0, -831.448), #plane 12
            (1300.874, 0, -802.406), #plane 13
            (1458.53, 0, -761.29), #plane 14
            (1780.247, 0, -673.92), #plane 15
            (2101.965, 0, -586.55), #plane 16
            (2423.682, 0, -499.18), #plane 17
            (2745.40, 0, -411.81), #plane 18
            (3235.68, 0, -274.137), #plane 19
            (3560.09, 0, -178.196), #plane 20
            (3876.111, 0, -76.161), #plane 21
            (4049.151, 0, -25.67), #plane 22
            (4137.633, 0, -4.381), #plane 23
            (4223.608, 0, 7.547), #plane 24
            (4281.578, 0, 12.828), #plane 25
            (4375.87, 0, 17.209)] #plane 26

"""faces_coordinates = [
    [(0.0,0.0,0.0),
    (202.00000000000006,0.0,0.0),
    (192.11341629162104,62.42143286373938,0.0),
    (163.42143286373937,118.73262096307957,0.0),
    (118.73262096307957,163.4214328637394,0.0),
    (62.42143286373939,192.11341629162104,0.0),
    (1.236893267138827e-14,202.00000000000003,0.0),
    (-62.42143286373942,192.11341629162104,0.0),
    (-118.73262096307954,163.42143286373937,0.0),
    (-163.4214328637394,118.73262096307963,0.0),
    (-192.11341629162106,62.42143286373942,0.0),
    (-202.0,2.473786534277653e-14,0.0),
    (-192.11341629162106,-62.421432863739355,0.0),
    (-163.42143286373937,-118.73262096307963,0.0),
    (-118.7326209630796,-163.42143286373937,0.0),
    (-62.42143286373942,-192.11341629162104,0.0),
    (-3.7106798014164807e-14,-202.00000000000003,0.0),
    (62.42143286373935,-192.11341629162106,0.0),
    (118.73262096307954,-163.42143286373943,0.0),
    (163.42143286373937,-118.73262096307961,0.0),
    (192.11341629162104,-62.42143286373944,0.0)],  # Plane 1
    [(5.333,0.0,-144.623),
    (215.62243230606742,0.0,-109.21230725915359),
    (205.32637209273366,65.89663422680844,-110.9460635428501),
    (175.4607502919871,125.34522407399778,-115.97514344241121),
    (128.937584608719,172.5222565473214,-123.80919153163687),
    (70.31600626051357,202.81279567213718,-133.68049450729222),
    (5.333000000000013,213.2491839262272,-144.623),
    (-59.64992508174403,202.8125423121566,-155.56549182299344),
    (-118.2718794088022,172.52266801729843,-165.43685810982655),
    (-164.79392327062808,125.34461474849167,-173.2707172952449),
    (-194.6622394207318,65.8972495003487,-178.30025089700194),
    (-204.95643230608363,2.6115592991817813e-14,-180.03369274084912),
    (-194.6622394207318,-65.89724950034866,-178.30025089700194),
    (-164.79392327062806,-125.3446147484917,-173.2707172952449),
    (-118.27187940880226,-172.52266801729837,-165.43685810982657),
    (-59.64992508174403,-202.8125423121566,-155.56549182299344),
    (5.332999999999962,-213.2491839262272,-144.623),
    (70.31600626051352,-202.8127956721372,-133.68049450729222),
    (128.93758460871894,-172.5222565473214,-123.80919153163688),
    (175.460750291987,-125.34522407399778,-115.97514344241122),
    (205.32637209273366,-65.8966342268085,-110.9460635428501)],  # Plane 2
    [(36.791,0.0,-289.331),
    (245.60162111223684,0.0,-216.94919585615264),
    (235.39321921225135,68.29671715866608,-220.48782115696656),
    (205.80080509950056,129.96087743587282,-230.7456917147168),
    (159.6591454819593,178.98554388751305,-246.7401682002485),
    (101.43638314747196,210.57226494226273,-266.9224202215355),
    (36.79100000000001,221.59914727874082,-289.331),
    (-27.965131040109412,210.93300894987496,-311.77796926378636),
    (-86.47790533799939,179.56934223915454,-332.060750602129),
    (-132.97791079741452,130.54459530069965,-348.17944355904575),
    (-162.86039802301465,68.65751609017748,-358.5378646306052),
    (-173.1664636457838,2.7213340934668742e-14,-362.1103439394999),
    (-162.86039802301465,-68.65751609017744,-358.5378646306052),
    (-132.97791079741452,-130.54459530069968,-348.17944355904575),
    (-86.47790533799943,-179.5693422391545,-332.060750602129),
    (-27.965131040109412,-210.93300894987496,-311.77796926378636),
    (36.79099999999996,-221.59914727874082,-289.331),
    (101.4363831474719,-210.5722649422628,-266.9224202215355),
    (159.65914548195929,-178.98554388751305,-246.7401682002485),
    (205.80080509950056,-129.96087743587287,-230.7456917147168),
    (235.39321921225135,-68.29671715866616,-220.48782115696656)],  # Plane 3
    [(91.665,0.0,-426.512),
    (284.3480028853792,0.0,-321.1051819136567),
    (278.53574533878384,69.20948409471188,-324.28476477623747),
    (253.83390326597873,134.30026694657295,-337.79785381250616),
    (211.36656245277106,187.79630114873316,-361.0295203356367),
    (155.2380742752482,223.02083147962884,-391.73448784285915),
    (91.66500000000002,235.31999999997265,-426.512),
    (28.091925724766085,223.0208314795787,-461.289512157133),
    (-28.03656245277422,187.79630114873814,-491.99447966436503),
    (-70.50390326590731,134.30026694651386,-515.2261461874548),
    (-95.2057453386867,69.20948409467593,-528.7392352237094),
    (-101.01800288537918,2.6896917649677364e-14,-531.9188180863433),
    (-95.20574533868673,-69.2094840946759,-528.7392352237094),
    (-70.5039032659074,-134.30026694651394,-515.2261461874548),
    (-28.03656245277429,-187.79630114873814,-491.9944796643651),
    (28.091925724766057,-223.02083147957876,-461.28951215713306),
    (91.66499999999996,-235.3199999999727,-426.512),
    (155.23807427524815,-223.02083147962887,-391.7344878428592),
    (211.36656245277106,-187.79630114873322,-361.0295203356367),
    (253.83390326597873,-134.300266946573,-337.79785381250616),
    (278.53574533878384,-69.20948409471195,-324.28476477623747)],  # Plane 4
    [(167.629,0.0,-554.016),
    (337.093648633136,0.0,-420.55238337099996),
    (334.36250697274147,68.9588621498414,-422.70332190869755),
    (315.191514514629,136.46719066467344,-437.8016330223387),
    (278.25202890080817,193.80977085216827,-466.8937025849309),
    (226.965636724862,232.45454986945953,-507.2848250925701),
    (167.629,246.1099999999665,-554.016),
    (108.29236327513372,232.45454986947607,-600.7471749074332),
    (57.00597109917703,193.80977085219416,-641.1382974150806),
    (20.06648548552883,136.46719066452752,-670.230366977537),
    (0.8954930275025106,68.95886214974054,-685.3286780911103),
    (-1.8356486331359747,2.6416856104420304e-14,-687.4796166289999),
    (0.8954930275024537,-68.95886214974048,-685.3286780911103),
    (20.06648548552883,-136.46719066452758,-670.230366977537),
    (57.005971099177,-193.80977085219413,-641.1382974150806),
    (108.29236327513372,-232.45454986947607,-600.7471749074332),
    (167.62899999999996,-246.1099999999665,-554.016),
    (226.96563672486195,-232.45454986945947,-507.28482509257014),
    (278.2520289008081,-193.80977085216827,-466.8937025849309),
    (315.1915145146289,-136.46719066467347,-437.8016330223387),
    (334.36250697274147,-68.95886214984147,-422.70332190869755)],  # Plane 5
    [(279.67,0.0,-656.591),
    (415.34796126262455,0.0,-502.0020962249157),
    (414.8001289718776,66.56119747602294,-502.6262859790294),
    (402.5891977640492,135.38596804590432,-516.5391901229625),
    (373.87752797063433,196.57010244449128,-549.2527238288886),
    (330.9535786971019,239.27381934241868,-598.1594600603433),
    (279.67,254.92647896021592,-656.591),
    (228.20098252125416,240.13902116072845,-715.2338253813376),
    (184.80900574174552,197.93360213361976,-764.6738233040215),
    (155.56555256065957,136.6914286865882,-797.9932609473362),
    (142.99590441480638,67.32171082287772,-812.3148803881293),
    (142.40204650445355,2.548431164549401e-14,-812.9915108630072),
    (142.99590441480635,-67.32171082287766,-812.3148803881293),
    (155.5655525606596,-136.69142868658827,-797.9932609473361),
    (184.8090057417455,-197.93360213361976,-764.6738233040215),
    (228.20098252125416,-240.13902116072845,-715.2338253813376),
    (279.66999999999996,-254.92647896021592,-656.591),
    (330.9535786971018,-239.27381934241873,-598.1594600603433),
    (373.87752797063433,-196.57010244449128,-549.2527238288886),
    (402.5891977640491,-135.38596804590438,-516.5391901229625),
    (414.8001289718776,-66.56119747602301,-502.6262859790294)],  # Plane 6
    [(407.779,0.0,-737.83),
    (507.60841377405006,0.0,-570.181848965),
    (507.60841377404995,63.398331128901944,-570.1818489650001),
    (501.9017835361741,133.65926527412643,-579.7652570193204),
    (481.88875445153417,199.3689860275885,-613.3740622382259),
    (448.7661572292242,246.55568776922888,-668.9983714660214),
    (407.779,263.760000000014,-737.83),
    (366.7918427707501,246.55568776938352,-806.6616285340219),
    (333.66924554847884,199.36898602755343,-862.2859377617523),
    (313.6562164636464,133.65926527438143,-895.8947429809812),
    (307.94958622595004,63.39833112890194,-905.4781510349999),
    (307.94958622595004,2.3895308344939494e-14,-905.4781510349999),
    (307.94958622595004,-63.39833112890189,-905.478151035),
    (313.6562164636464,-133.65926527438145,-895.8947429809812),
    (333.6692455484788,-199.36898602755343,-862.2859377617524),
    (366.7918427707501,-246.55568776938352,-806.6616285340219),
    (407.779,-263.760000000014,-737.83),
    (448.7661572292241,-246.5556877692289,-668.9983714660215),
    (481.88875445153417,-199.36898602758856,-613.3740622382259),
    (501.9017835361741,-133.65926527412648,-579.7652570193204),
    (507.60841377404995,-63.398331128902,-570.1818489650001)],  # Plane 7
    [(536.748,0.0,-799.26),
    (601.576038137426,0.0,-627.7533005065345),
    (601.576038137426,59.5740263042054,-627.7533005065345),
    (599.6791367255745,129.31373405527185,-632.7716738795111),
    (587.7423261452141,198.50838308371632,-664.351265734141),
    (565.436594017935,249.71881276729292,-723.3624992504984),
    (536.748,268.650000000007,-799.26),
    (508.05940598204535,249.71881276746413,-875.1575007495536),
    (485.75367385476625,198.5083830837934,-934.1687342659114),
    (473.81686327436387,129.31373405539875,-965.7483261206523),
    (471.9199618625451,59.574026304231964,-970.7666994935419),
    (471.9199618625452,2.2453899062339765e-14,-970.7666994935416),
    (471.9199618625451,-59.57402630423192,-970.7666994935419),
    (473.81686327436387,-129.3137340553988,-965.7483261206522),
    (485.75367385476625,-198.50838308379338,-934.1687342659114),
    (508.05940598204535,-249.71881276746413,-875.1575007495536),
    (536.748,-268.650000000007,-799.26),
    (565.436594017935,-249.71881276729295,-723.3624992504986),
    (587.7423261452141,-198.50838308371632,-664.351265734141),
    (599.6791367255745,-129.31373405527188,-632.7716738795111),
    (601.576038137426,-59.574026304205454,-627.7533005065345)],  # Plane 8
    [(672.528,0.0,-835.133),
    (704.3604752055501,0.0,-667.5189623355001),
    (704.3604752055501,55.4345493742089,-667.5189623355001),
    (704.157529677885,123.16515233381388,-668.5875729005984),
    (699.219232797468,196.8981637385582,-694.5901967609132),
    (687.887839535804,253.36388724830346,-754.255697627169),
    (672.528,274.53999999999303,-835.133),
    (657.1681604641956,253.36388724831158,-916.0103023728338),
    (645.8367672025518,196.8981637384133,-975.6758032389835),
    (640.8984703221232,123.16515233378209,-1001.6784270993586),
    (640.69552479445,55.434549374208956,-1002.7470376645001),
    (640.69552479445,2.0893699040220108e-14,-1002.7470376645),
    (640.69552479445,-55.43454937420891,-1002.7470376645001),
    (640.8984703221232,-123.1651523337821,-1001.6784270993586),
    (645.8367672025518,-196.89816373841327,-975.6758032389836),
    (657.1681604641956,-253.36388724831158,-916.0103023728338),
    (672.528,-274.53999999999303,-835.133),
    (687.887839535804,-253.3638872483035,-754.255697627169),
    (699.219232797468,-196.8981637385582,-694.5901967609132),
    (704.157529677885,-123.16515233381394,-668.5875729005984),
    (704.3604752055501,-55.434549374208956,-667.5189623355001)],  # Plane 9
    [(814.82,0.0,-847.56),
    (816.8546612432158,0.0,-686.7728731719262),
    (816.8546612432158,52.24708715425309,-686.7728731719262),
    (816.8545309716272,116.82055845015618,-686.7831677575705),
    (816.6114158916964,194.86296824025152,-705.995100614204),
    (815.8733398573067,256.204297983167,-764.320841739848),
    (814.82,279.44000000002393,-847.56),
    (813.7666601426941,256.2042979829869,-930.7991582600935),
    (813.0285841083074,194.8629682398443,-989.1248993855),
    (812.7854690283713,116.82055845024362,-1008.3368322425497),
    (812.7853387567861,52.2470871542049,-1008.3471268279254),
    (812.7853387567861,1.969232053027193e-14,-1008.3471268279254),
    (812.7853387567861,-52.24708715420486,-1008.3471268279254),
    (812.7854690283713,-116.82055845024365,-1008.3368322425497),
    (813.0285841083074,-194.8629682398443,-989.1248993855),
    (813.7666601426941,-256.2042979829869,-930.7991582600935),
    (814.82,-279.44000000002393,-847.56),
    (815.8733398573067,-256.204297983167,-764.320841739848),
    (816.6114158916964,-194.86296824025158,-705.995100614204),
    (816.8545309716272,-116.82055845015624,-686.7831677575705),
    (816.8546612432158,-52.24708715425314,-686.7728731719262)],  # Plane 10
    [(977.817,0.0,-845.565),
    (968.4285075837266,0.0,-688.9661794099186),
    (968.4285075837266,50.97340194507523,-688.9661794099186),
    (968.4285075837266,113.97999179360825,-688.9661794099186),
    (969.3754161638736,194.14875865172294,-704.7604901770674),
    (972.7987208498472,258.07771112130274,-761.8607627847074),
    (977.817,282.3800000000079,-845.565),
    (982.8352791501587,258.07771112160833,-929.2692372153919),
    (986.2585838361443,194.1487586521356,-986.369509823232),
    (987.2054924162635,113.97999179348801,-1002.1638205899163),
    (987.2054924162635,50.97340194502146,-1002.1638205899162),
    (987.2054924162635,1.921225898502488e-14,-1002.1638205899166),
    (987.2054924162635,-50.97340194502142,-1002.1638205899162),
    (987.2054924162635,-113.97999179348804,-1002.1638205899162),
    (986.2585838361443,-194.14875865213557,-986.369509823232),
    (982.8352791501587,-258.07771112160833,-929.2692372153919),
    (977.817,-282.3800000000079,-845.565),
    (972.7987208498472,-258.0777111213028,-761.8607627847075),
    (969.3754161638736,-194.14875865172297,-704.7604901770674),
    (968.4285075837266,-113.9799917936083,-688.9661794099186),
    (968.4285075837266,-50.97340194507528,-688.9661794099186)],  # Plane 11
    [(1138.74,0.0,-831.448),
    (1119.1473457156126,0.0,-679.7480016545175),
    (1119.1473457156126,49.69971673570775,-679.7480016545175),
    (1119.1473457156126,111.13194508352647,-679.7480016545175),
    (1120.728285860004,193.54350630545196,-691.9887432001697),
    (1127.8898379521754,260.7022536670623,-747.4384757766893),
    (1138.74,286.3099999999964,-831.448),
    (1149.5901620478257,260.70225366708803,-915.4575242233191),
    (1156.7517141400026,193.54350630552406,-970.9072567998822),
    (1158.3326542843956,111.13194508357236,-983.1479983455451),
    (1158.3326542843956,49.69971673572832,-983.1479983455453),
    (1158.3326542843956,1.8732197439736427e-14,-983.1479983455454),
    (1158.3326542843956,-49.69971673572829,-983.1479983455453),
    (1158.3326542843956,-111.13194508357238,-983.1479983455451),
    (1156.7517141400026,-193.54350630552406,-970.9072567998824),
    (1149.5901620478257,-260.70225366708803,-915.4575242233191),
    (1138.74,-286.3099999999964,-831.448),
    (1127.8898379521754,-260.70225366706234,-747.4384757766893),
    (1120.728285860004,-193.54350630545198,-691.9887432001697),
    (1119.1473457156126,-111.13194508352652,-679.7480016545175),
    (1119.1473457156126,-49.699716735707796,-679.7480016545175)],  # Plane 12
    [(1300.874,0.0,-802.406),
    (1270.985464527,0.0,-654.3986843959999),
    (1270.9854645269997,49.06124953271232,-654.3986843959998),
    (1270.9854645269997,109.70428901622464,-654.3986843959997),
    (1273.0045284235562,193.78743961869196,-664.3970407099852),
    (1283.921787089343,263.577473545138,-718.4590455324461),
    (1300.874,290.22500000002105,-802.406),
    (1317.826212910683,263.57747354554033,-886.352954467682),
    (1328.7434715765442,193.78743961938895,-940.4149592905111),
    (1330.7625354730003,109.70428901622452,-950.413315604),
    (1330.762535473,49.06124953271228,-950.413315604),
    (1330.762535473,1.8491554343734726e-14,-950.413315604),
    (1330.762535473,-49.061249532712246,-950.413315604),
    (1330.7625354730003,-109.70428901622454,-950.413315604),
    (1328.7434715765442,-193.78743961938895,-940.4149592905112),
    (1317.826212910683,-263.57747354554033,-886.352954467682),
    (1300.874,-290.22500000002105,-802.406),
    (1283.921787089343,-263.577473545138,-718.4590455324461),
    (1273.0045284235562,-193.78743961869196,-664.3970407099852),
    (1270.9854645269997,-109.70428901622469,-654.3986843959997),
    (1270.9854645269997,-49.06124953271237,-654.3986843959998)],  # Plane 13
    [(1458.53,0.0,-761.29),
    (1418.1627010708517,0.0,-612.7369630830766),
    (1418.1627010708517,50.018138038173845,-612.7369630830765),
    (1418.1627010708517,111.84395676132459,-612.7369630830767),
    (1421.1385506381926,196.26056751587942,-623.6881909918923),
    (1435.8921202852841,265.6938493976906,-677.9818305115339),
    (1458.53,292.1899999999718,-761.29),
    (1481.1678797147047,265.69384939755855,-844.5981694884247),
    (1495.9214493618265,196.26056751597912,-898.8918090081775),
    (1498.8972989291667,111.8439567613757,-909.8430369169911),
    (1498.8972989291667,50.01813803819669,-909.8430369169912),
    (1498.8972989291667,1.8852212826113204e-14,-909.8430369169912),
    (1498.8972989291667,-50.01813803819665,-909.8430369169912),
    (1498.8972989291667,-111.84395676137572,-909.8430369169911),
    (1495.9214493618265,-196.26056751597906,-898.8918090081775),
    (1481.1678797147047,-265.69384939755855,-844.5981694884247),
    (1458.53,-292.1899999999718,-761.29),
    (1435.8921202852841,-265.6938493976906,-677.9818305115339),
    (1421.1385506381926,-196.26056751587947,-623.6881909918924),
    (1418.1627010708517,-111.84395676132462,-612.7369630830767),
    (1418.1627010708517,-50.01813803817389,-612.7369630830765)],  # Plane 14
    [(1780.247,0.0,-673.92),
    (1736.0483427396377,0.0,-511.16983956540076),
    (1736.0483427396377,54.796082171301286,-511.1698395654009),
    (1736.0483427396377,122.52776463569388,-511.169839565401),
    (1740.5377929828187,208.54249617394464,-527.7010826535505),
    (1756.9293190357894,273.8253877163644,-588.058651418005),
    (1780.247,294.145,-673.92),
    (1803.5652955279515,273.8326046928229,-759.7836115545285),
    (1819.9566452800404,208.54479781725257,-820.1405311364383),
    (1824.4456572603312,122.52776463560753,-836.6701604344842),
    (1824.4456572603312,54.79608217126267,-836.6701604344843),
    (1824.4456572603312,2.065305594424472e-14,-836.6701604344843),
    (1824.4456572603312,-54.79608217126262,-836.6701604344843),
    (1824.4456572603312,-122.52776463560753,-836.6701604344842),
    (1819.9566452800404,-208.54479781725246,-820.1405311364383),
    (1803.5652955279515,-273.8326046928229,-759.7836115545285),
    (1780.247,-294.145,-673.92),
    (1756.9293190357894,-273.8253877163644,-588.0586514180051),
    (1740.5377929828187,-208.54249617394473,-527.7010826535505),
    (1736.0483427396377,-122.52776463569388,-511.16983956540105),
    (1736.0483427396377,-54.79608217130134,-511.1698395654008)],  # Plane 15
    [(2101.965,0.0,-586.55),
    (2053.782710907702,0.0,-409.13114236996097),
    (2053.782710907702,59.734861553869585,-409.13114236996097),
    (2053.782710907702,133.57121106099106,-409.131142369961),
    (2060.01487573949,220.31121458425247,-432.07948263872356),
    (2078.0843909267346,280.43599397622336,-498.6158137853897),
    (2101.965,294.15500000000003,-586.55),
    (2125.8456090732557,280.4359939761073,-674.4841862145738),
    (2143.9151242604908,220.31121458415132,-741.0205173612054),
    (2150.1356912854903,133.53905955615096,-763.9261516965183),
    (2150.1472890923064,59.73486155387949,-763.9688576300683),
    (2150.1472890923064,2.2514519078902244e-14,-763.9688576300686),
    (2150.1472890923064,-59.73486155387945,-763.9688576300683),
    (2150.1356912854903,-133.539059556151,-763.9261516965183),
    (2143.9151242604908,-220.3112145841513,-741.0205173612055),
    (2125.8456090732557,-280.4359939761073,-674.4841862145738),
    (2101.965,-294.15500000000003,-586.55),
    (2078.0843909267346,-280.4359939762234,-498.6158137853898),
    (2060.01487573949,-220.3112145842525,-432.0794826387236),
    (2053.782710907702,-133.57121106099112,-409.131142369961),
    (2053.782710907702,-59.73486155386964,-409.13114236996097)],  # Plane 16
    [(2423.682,0.0,-499.18),
    (2371.6458091903346,0.0,-307.5701428785779),
    (2371.6458091903346,64.51280568710214,-307.57014287857805),
    (2371.6458091903346,144.2550189355954,-307.57014287857805),
    (2379.743254252167,230.75494086241895,-337.38689670326505),
    (2399.3627971560663,285.5865108485148,-409.6308053005403),
    (2423.682,294.15,-499.18),
    (2448.001172654832,285.5861563303147,-588.7290835358784),
    (2467.620733050665,230.75487418017474,-660.9730565426885),
    (2475.678549802518,144.14512591407288,-690.6438893325162),
    (2475.718190809682,64.51280568712293,-690.7898571214837),
    (2475.718190809682,2.4315362197100655e-14,-690.789857121484),
    (2475.718190809682,-64.51280568712289,-690.7898571214837),
    (2475.678549802518,-144.1451259140729,-690.6438893325162),
    (2467.620733050665,-230.7548741801747,-660.9730565426886),
    (2448.001172654832,-285.5861563303147,-588.7290835358784),
    (2423.682,-294.15,-499.18000000000006),
    (2399.3627971560663,-285.5865108485149,-409.6308053005404),
    (2379.743254252167,-230.754940862419,-337.3868967032651),
    (2371.6458091903346,-144.25501893559544,-307.5701428785781),
    (2371.6458091903346,-64.5128056871022,-307.57014287857805)],  # Plane 17
    [(2745.4,0.0,-411.81),
    (2689.380177358112,0.0,-205.5314456828966),
    (2689.3801773580985,69.45158506978755,-205.53144568284628),
    (2689.6322246743393,154.59973838265637,-206.45954494417373),
    (2699.5742057880916,240.66523186703435,-243.0683272372348),
    (2720.7336816043876,289.6627760084319,-320.98264177184745),
    (2745.4,294.15000000000003,-411.81),
    (2770.066338183795,289.66300838603195,-502.63743109303294),
    (2791.225860914391,240.66558217123833,-580.5519183774595),
    (2801.167837606059,154.59991103672368,-617.1606843873352),
    (2801.419822641888,69.45158506977064,-618.0885543171034),
    (2801.419822641888,2.617682533176973e-14,-618.0885543171034),
    (2801.419822641888,-69.4515850697706,-618.0885543171034),
    (2801.167837606059,-154.5999110367237,-617.1606843873351),
    (2791.225860914391,-240.6655821712383,-580.5519183774595),
    (2770.066338183795,-289.66300838603195,-502.63743109303294),
    (2745.4,-294.15000000000003,-411.81000000000006),
    (2720.7336816043876,-289.66277600843193,-320.9826417718475),
    (2699.5742057880916,-240.66523186703438,-243.06832723723483),
    (2689.6322246743393,-154.59973838265645,-206.45954494417379),
    (2689.3801773580985,-69.45158506978763,-205.53144568284628)],  # Plane 18
    [(3235.68,0.0,-274.137),
    (3171.5272310193504,0.0,-50.70320350412794),
    (3172.3275782471183,74.58894218852662,-53.49068442594245),
    (3175.214265618077,159.1862532831788,-63.54455316517874),
    (3186.4772815742817,245.39360776573164,-102.77182979056388),
    (3209.545601194131,291.45510315971035,-183.1150840778081),
    (3235.68,294.15,-274.137),
    (3262.0552755652525,294.14140029921657,-365.99785100935765),
    (3288.103056682738,261.45472081803564,-456.71809142686493),
    (3303.6838117288717,179.03151443952686,-510.9833602148718),
    (3305.491551076678,82.19369683547896,-517.2794261832361),
    (3305.491551076678,3.0979423194925113e-14,-517.2794261832362),
    (3305.491551076678,-82.19369683547889,-517.2794261832362),
    (3303.6838117288717,-179.03151443952692,-510.9833602148718),
    (3288.103056682738,-261.45472081803564,-456.71809142686493),
    (3262.0552755652525,-294.14140029921657,-365.99785100935765),
    (3235.68,-294.15,-274.13700000000006),
    (3209.545601194131,-291.45510315971035,-183.11508407780815),
    (3186.4772815742817,-245.3936077657317,-102.77182979056391),
    (3175.214265618077,-159.18625328317884,-63.54455316517877),
    (3172.3275782471183,-74.58894218852669,-53.49068442594245)], # Plane 19
    [(3560.09,0.0,-178.196),
    (3486.964484478704,0.0,50.5913602329162),
    (3488.20717936493,76.71604954818082,46.70334822277334),
    (3492.5279840066883,161.23106511828718,33.18487274916035),
    (3505.6157798358236,246.2720146941518,-7.762835279554054),
    (3531.2237939330143,291.80904634130457,-87.8824748381602),
    (3560.09,294.15,-178.19599999999997),
    (3589.187776854638,294.1500000000001,-269.2340392912271),
    (3620.8882212465605,274.8621346223106,-368.41502883961783),
    (3642.5724770273114,196.837489663194,-436.2584293726169),
    (3646.6595796730157,92.39031113256218,-449.04572281794435),
    (3646.6595796730157,3.4822603896445934e-14,-449.04572281794447),
    (3646.6595796730157,-92.3903111325621,-449.04572281794435),
    (3642.5724770273114,-196.83748966319402,-436.2584293726168),
    (3620.8882212465605,-274.8621346223105,-368.4150288396179),
    (3589.187776854638,-294.1500000000001,-269.2340392912271),
    (3560.09,-294.15,-178.19600000000005),
    (3531.2237939330143,-291.8090463413046,-87.88247483816028),
    (3505.6157798358236,-246.27201469415184,-7.762835279554082),
    (3492.5279840066883,-161.2310651182872,33.18487274916032),
    (3488.20717936493,-76.7160495481809,46.70334822277334)], # Plane 20
    [(3876.111,0.0,-76.161),
    (3806.470588340121,0.0,153.1984647176673),
    (3807.655282355638,76.55797427250204,149.29669592026033),
    (3811.762973789482,160.91663342134368,135.76808679753964),
    (3824.190921911162,245.96820031565608,94.83685935665216),
    (3848.5736506005155,291.7096282081128,14.53277344947442),
    (3876.111,294.15,-76.16099999999999),
    (3903.878720166163,294.1499999999999,-167.61349549709917),
    (3936.710998903958,287.0887952832628,-275.7460251199864),
    (3962.814110008082,216.8205210213661,-361.71616009776307),
    (3969.710980216826,104.67825221808434,-384.43088020927775),
    (3969.710980216826,3.945402141067046e-14,-384.43088020927775),
    (3969.710980216826,-104.67825221808425,-384.43088020927775),
    (3962.814110008082,-216.82052102136618,-361.716160097763),
    (3936.710998903958,-287.08879528326275,-275.74602511998654),
    (3903.878720166163,-294.1499999999999,-167.61349549709917),
    (3876.111,-294.15,-76.16100000000006),
    (3848.5736506005155,-291.70962820811286,14.532773449474348),
    (3824.190921911162,-245.9682003156561,94.83685935665213),
    (3811.762973789482,-160.91663342134376,135.76808679753958),
    (3807.655282355638,-76.5579742725021,149.29669592026033)], # Plane 21
    [(4049.151,0.0,-25.67),
    (3981.3960442998014,0.0,209.37361175377868),
    (3982.572012251508,78.10058461789697,205.2941499370109),
    (3986.639511569944,163.96907201680818,191.18389452128127),
    (3999.073479162357,248.84151566063056,148.0501543963254),
    (4022.8280969967846,292.48177062303915,65.64479948266008),
    (4049.151,294.15,-25.669999999999984),
    (4075.62404104424,294.15,-117.50563204847701),
    (4107.611341296961,290.4968075703615,-228.47036523964545),
    (4134.687245267038,224.3635388066494,-322.39734364082443),
    (4142.601283592303,109.62199979425925,-349.8513377037692),
    (4142.601283592303,4.13173570948868e-14,-349.8513377037692),
    (4142.601283592303,-109.62199979425915,-349.8513377037692),
    (4134.687245267038,-224.3635388066495,-322.3973436408245),
    (4107.611341296961,-290.49680757036145,-228.47036523964556),
    (4075.62404104424,-294.15,-117.50563204847701),
    (4049.151,-294.15,-25.670000000000055),
    (4022.8280969967846,-292.48177062303915,65.64479948266002),
    (3999.073479162357,-248.8415156606305,148.05015439632535),
    (3986.639511569944,-163.96907201680824,191.18389452128122),
    (3982.572012251508,-78.10058461789707,205.294149937011)], # Plane 22
    [(4137.633,0.0,-4.381),
    (4092.4089175233285,0.0,245.02409395208468),
    (4093.2278957256353,80.86663566671848,240.50753276819623),
    (4096.04512019319,169.35119417609198,224.9708962122863),
    (4104.769205389738,253.52285068753346,176.85866996173817),
    (4120.6242056724295,293.3985300402239,89.42034908138015),
    (4137.633,294.15,-4.3809999999999825),
    (4154.685358274491,294.1499999999999,-98.42259873774846),
    (4175.357309537478,291.0185694494912,-212.42579492371283),
    (4193.028350689051,225.57699105060294,-309.8793514643653),
    (4198.257882304816,110.40465617173533,-338.71955678258087),
    (4198.257882304816,4.161234617638012e-14,-338.71955678258087),
    (4198.257882304816,-110.40465617173525,-338.71955678258087),
    (4193.028350689051,-225.57699105060297,-309.8793514643652),
    (4175.357309537478,-291.0185694494912,-212.42579492371289),
    (4154.685358274491,-294.1499999999999,-98.42259873774846),
    (4137.633,-294.15,-4.3810000000000535),
    (4120.6242056724295,-293.39853004022393,89.4203490813801),
    (4104.769205389738,-253.5228506875335,176.85866996173812),
    (4096.04512019319,-169.351194176092,224.97089621228628),
    (4093.2278957256353,-80.86663566671858,240.50753276819623)], # Plane 23
    [(4223.608,0.0,7.547),
    (4195.25142907308,0.0,278.0511195588279),
    (4195.808110720855,86.63881420762813,272.7407215070245),
    (4197.70238411386,180.52957400289412,254.67052685270497),
    (4203.717694352675,262.5873564258736,197.28819369905028),
    (4213.633424057623,294.4501619708641,102.69827517423835),
    (4223.608,294.15,7.5470000000000175),
    (4233.57240787742,294.1500000000001,-87.50727813373635),
    (4245.591609864059,290.2226894475733,-202.16301911082635),
    (4255.707631546491,223.69407599524206,-298.66359901861284),
    (4258.640585948667,109.17963286624439,-326.6421670306441),
    (4258.640585948667,4.1150625669022825e-14,-326.64216703064415),
    (4258.640585948667,-109.17963286624428,-326.64216703064403),
    (4255.707631546491,-223.6940759952421,-298.6635990186128),
    (4245.591609864059,-290.2226894475732,-202.16301911082638),
    (4233.57240787742,-294.1500000000001,-87.50727813373635),
    (4223.608,-294.15,7.5469999999999455),
    (4213.633424057623,-294.4501619708641,102.69827517423828),
    (4203.717694352675,-262.5873564258736,197.28819369905023),
    (4197.70238411386,-180.52957400289418,254.67052685270497),
    (4195.808110720855,-86.6388142076282,272.7407215070245)], # Plane 24
    [(4281.578,0.0,12.828),
    (4259.579125786816,0.0,298.7090756460289),
    (4260.03635663541,91.22667825873462,292.7672421891006),
    (4261.607532989386,189.1107657595025,272.3493979961996),
    (4266.575463417125,269.1352884299072,207.7898536916227),
    (4274.245063912892,294.1500000000001,108.1214061948447),
    (4281.578,294.15,12.828000000000017),
    (4288.910936087109,294.1500000000001,-82.46540619484472),
    (4297.691693415507,289.0686852251155,-196.57362490199142),
    (4304.925558038304,221.0902016908872,-290.5795717246554),
    (4306.956999087153,107.47749115827189,-316.97867499368965),
    (4306.956999087153,4.050907564342218e-14,-316.97867499368965),
    (4306.956999087153,-107.47749115827182,-316.9786749936897),
    (4304.925558038304,-221.09020169088723,-290.57957172465535),
    (4297.691693415507,-289.0686852251154,-196.57362490199154),
    (4288.910936087109,-294.1500000000001,-82.46540619484472),
    (4281.578,-294.15,12.827999999999946),
    (4274.245063912892,-294.15000000000015,108.12140619484461),
    (4266.575463417125,-269.13528842990723,207.78985369162265),
    (4261.607532989386,-189.11076575950258,272.34939799619957),
    (4260.03635663541,-91.22667825873471,292.7672421891006)], # Plane 25
    [(4375.87,0.0,17.209),
    (4375.87,0.0,336.0552878358968),
    (4375.87,101.44609857691444,329.4279875008275),
    (4375.87,207.09563052037794,302.25168165682635),
    (4375.87,277.7979696852813,219.04103916990084),
    (4375.87,289.5112229000256,111.27689860069356),
    (4375.87,294.6529522580374,17.209000000000017),
    (4375.87,299.61211373956576,-80.14087698395872),
    (4375.87,289.5808025003229,-193.18376831040567),
    (4375.87,215.15848061536215,-278.9312427550318),
    (4375.87,103.5845764320394,-301.5915455901593),
    (4375.87,3.923813805366938e-14,-303.1947121640991),
    (4375.87,-103.58457643204885,-301.5915455901887),
    (4375.87,-215.1584806153648,-278.9312427550354),
    (4375.87,-289.5808025003258,-193.18376831040786),
    (4375.87,-299.61211373956553,-80.14087698395866),
    (4375.87,-294.65295225803726,17.208999999999946),
    (4375.87,-289.5112229000265,111.27689860069378),
    (4375.87,-277.7979696852859,219.04103916990414),
    (4375.87,-207.09563052038084,302.2516816568302),
    (4375.87,-101.44609857691438,329.4279875008271)], # Plane 26
]"""
 
def gradient_to_spline_angle(m):
    """
    Function to convert the gradient of the spline in the x-z plane to the angle of the spline starting from the north direction going anti-clockwise.

    Parameters:
    m (float): Gradient of the spline in the x-z plane.

    Returns:
    angle (float): Angle of the spline starting from the north direction going anti-clockwise.
    """
    if m == float('inf'):
        angle = 0
    elif m <= 0:
        angle = math.pi / 2 - math.atan(-m)
    else:
        angle = math.atan(m) + math.pi / 2
    return angle

def get_spline_details(dir):
    """
    This function gets the spline details and calculates the angle of the spline at the plane in radians and degrees if the columns are not already present.

    Parameters:
    dir (str): Directory of the spline details data.

    Returns:
    df_spline (list of dict): List containing the spline details.
    """
    spline_details = []
    with open(f'{dir}/spline_details.csv', mode='r') as file:
        reader = csv.DictReader(file)
        for row in reader:
            spline_details.append(row)

    for row in spline_details:
        if 'angle_rad' not in row:
            tangent_grad = float(row['tangent_grad'])
            angle_rad = gradient_to_spline_angle(tangent_grad)
            row['angle_rad'] = angle_rad
            row['angle_deg'] = math.degrees(angle_rad)

    return spline_details

def get_cartesian_coords(centre_coords, phi_rad, polar_radial_distance, theta):
    """
    This function converts the local polar coordinates to cartesian coordinates.

    Parameters:    
    centre_coords (tuple): Tuple containing the centre coordinates.
    polar_coords (list of dict): List containing the polar coordinates.
    theta (float): Angle of the spline at the plane in radians.

    Returns:
    cartesian_coords (list of tuple): List containing the cartesian coordinates.
    """
    cartesian_coords = []
    for i in range(len(phi_rad)):
        x_global = centre_coords[0] + polar_radial_distance[i] * math.cos(phi_rad[i]) * math.cos(theta) * 10
        y_global = centre_coords[1] + polar_radial_distance[i] * math.sin(phi_rad[i]) * 10
        z_global = centre_coords[2] + polar_radial_distance[i] * math.cos(phi_rad[i]) * math.sin(theta) * 10
        cartesian_coords.append((x_global, y_global, z_global))
    return cartesian_coords

def run(context):
    ui = None
    try:
        app = adsk.core.Application.get()
        ui = app.userInterface
        design = app.activeProduct

        ui.messageBox('Script started')

        rootComp = design.rootComponent
        sketches = rootComp.sketches
        df_spline = get_spline_details('C:/Users/ASUS/UCL/Research Assistant/code/OPSIDIAN/fusion360/reconstruction/data/spline')
        faces_coordinates = []
        baseline_factor = [1, 0]
        for plane in range(1, 27):
            phi_rad = []
            polar_radial_distance = []
            for baseline in range(1,3):
                with open(f'C:/Users/ASUS/UCL/Research Assistant/code/OPSIDIAN/fusion360/reconstruction/data/baseline_{baseline}/plane_{plane}/polar_coordinates.csv', mode='r') as file:
                    reader = csv.DictReader(file)
                    i = 0
                    for row in reader:
                        if baseline == 1:
                            polar_radial_distance.append(baseline_factor[baseline-1]*float(row['radial_distance']))
                            phi_rad.append(float(row['phi_rad']))
                        else:
                            polar_radial_distance[i] = (polar_radial_distance[i] + baseline_factor[baseline-1]*float(row['radial_distance']))
                            i += 1
            theta = float(next(row['angle_rad'] for row in df_spline if int(row['plane']) == plane))
            cartesian_coords = get_cartesian_coords(centres[plane-1], phi_rad, polar_radial_distance, theta)
            faces_coordinates.append(cartesian_coords)

        for face_coords in faces_coordinates:

            # Create a new sketch on the first point's plane
            first_point = face_coords[0]
            plane_input = rootComp.constructionPlanes.createInput()
            plane_input.setByOffset(rootComp.xYConstructionPlane, adsk.core.ValueInput.createByReal(first_point[2]))
            plane = rootComp.constructionPlanes.add(plane_input)
            sketch = sketches.add(plane)
            points = adsk.core.ObjectCollection.create()
            for coord in face_coords[1:]:
                points.add(adsk.core.Point3D.create(coord[0]*10, coord[1]*10, coord[2]*10))

            # Create a closed profile with a spline
            splines = sketch.sketchCurves.sketchFittedSplines
            spline = splines.add(points)

            # Ensure the spline is closed by connecting the last point to the first
            spline.isClosed = True


            # Check if profile exists
            if sketch.profiles.count == 0:
                ui.messageBox('No profiles found in sketch')
                continue

            # Extrude the profile
            prof = sketch.profiles.item(0)
            extrudes = rootComp.features.extrudeFeatures
            extInput = extrudes.createInput(prof, adsk.fusion.FeatureOperations.NewBodyFeatureOperation)
            distance = adsk.core.ValueInput.createByReal(5.0)
            extInput.setDistanceExtent(False, distance)
            extrudes.add(extInput)

        ui.messageBox('Script completed')

    except:
        if ui:
            ui.messageBox('Failed:\n{}'.format(traceback.format_exc()))
